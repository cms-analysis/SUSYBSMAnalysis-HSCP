process TER = {

  source = PoolSource {

   untracked vstring fileNames = {
//'/store/mc/2007/10/6/RelVal-CSA07Muon-PDMuon-Skims6-B01/0000/30064CE9-2874-DC11-A073-000423D9899C.root'

//'/store/mc/2007/9/28/CSA07-bbe_Pt_5_50-2217/0000/000B1640-8F77-DC11-BDE1-000423D999CA.root'
//'store/CSA07/2007/10/20/CSA07-CSA07AllEvents-Tier0-A2-Stew/0000/00B95C4E-527F-DC11-B824-00304885AB90.root'
//'/store/mc/2007/10/20/RelVal-RelValZMM-1192895175/0000/5808BE4E-B27F-DC11-B565-000423D94534.root'
//ile:/afs/cern.ch/user/q/querten/scratch0/HSCP_Test/Stop-Stop_130GeV_167_SIM-DIGI-RAW-HLT-RECO_0000.root'
'file:/afs/cern.ch/user/q/querten/scratch0/HSCP_Test/Stop-Stop_800GeV_167_SIM-DIGI-RAW-HLT-RECO_0000.root'
//'file:grhad900GeV_GENSIM145_DIGIHLTRECO163_1kevt.root'
//'file:Reco165Stau156.root'
//rfio:/castor/cern.ch/user/j/jiechen/storage/gluinorhad/200/grhad200GeV_GENSIM145_DIGIHLTRECO163_1kevt.root'
 }

 }
 untracked PSet maxEvents = {untracked int32 input = -1}
     untracked PSet options = {
        untracked bool wantSummary = true  # default is false
     }



# tracker geometry
include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
 
# tracker numbering
#include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"

#Refitter (+ access to Trajectory)
#include "RecoTracker/TrackProducer/data/RefitterWithMaterial.cff"
#replace TrackRefitter.TrajectoryInEvent = true


#Standard reconstruction:
include "Configuration/StandardSequences/data/Reconstruction.cff"


include "Configuration/StandardSequences/data/FakeConditions.cff"

replace genParticleCandidates.abortOnUnknownPDGCode = false


include "RecoTracker/DeDx/data/dedxHitsFromRefitter.cfi"
include "RecoTracker/DeDx/data/dedxTruncated40.cfi"
include "RecoTracker/DeDx/data/dedxHarmonic2.cfi"
#  include "RecoTracker/TrackProducer/data/RefitterWithMaterial.cff"


module dedxHarmonic4 = dedxHarmonic2 from "RecoTracker/DeDx/data/dedxHarmonic2.cfi"
replace dedxHarmonic4.exponent = -4

replace dedxHarmonic4.trackDeDxHits = dedxHitsFromRefitter

include "SUSYBSMAnalysis/Skimming/data/SusyMuonHits_EventContent.cff"


    module out = PoolOutputModule {
        untracked string fileName = 'out-stop.root'
#  using susyMuonHitsEventSelection
         untracked vstring outputCommands = {
                       "drop *",
                       "keep *_dedxHitsFromRefitter_*_SKIM",
                       "keep *_dedxTruncated40_*_SKIM",
                       "keep *_*_*_TER",
                       "keep recoVertexs_*_*_*",
                       "keep *_ctfWithMaterialTracks_*_*",
                       "keep *_muons_*_*",
                       "keep *_*_*_Split",
                       "keep *_TriggerResult_*_*",
                       "keep recoTracks_*_*_Rec1",
                       "keep recoTracks_*_*_RECO",
                       "keep double_*_*_*",
                       "keep *_genEventRunInfo_*_*"
                        
    }

    }

  service = TFileService {
    string fileName = "tmp.root"
  }



        ## _Vdrift1D_ ##
        replace dt4DSegments.Reco4DAlgoConfig.Reco2DAlgoConfig.debug = false
        replace dt4DSegments.Reco4DAlgoConfig.debug = false
        replace standAloneMuons.STATrajBuilderParameters.BWFilterParameters.MuonTrajectoryUpdatorParameters.Granularity = 0
        replace standAloneMuons.STATrajBuilderParameters.BWFilterParameters.MaxChi2 = 1000
        replace standAloneMuons.STATrajBuilderParameters.BWFilterParameters.MuonTrajectoryUpdatorParameters.MaxChi2 = 1000
#        replace standAloneMuons.STATrajBuilderParameters.SmootherParameters.MaxChi2 = 1000



module betaFromTOF = BetaFromTOF {
          untracked InputTag  Muons = muons
          untracked InputTag  DTsegments  = dt4DSegments
          int32 HitsMin = 6
          bool OnlyMatched = true
          bool debug  = true
          PSet ServiceParameters = {
               untracked vstring Propagators = {
                 "SteppingHelixPropagatorAny",
                 "PropagatorWithMaterial",
                 "PropagatorWithMaterialOpposite"
               }
               bool RPCLayers = true
          }
     }



module dedxFit = DeDxBetaWithLikelihood
   {
     InputTag trackDeDxHits = dedxHitsFromRefitter
   }



include "SUSYBSMAnalysis/CSA07Skims/data/hscpMETSkim.cfi"
include "SUSYBSMAnalysis/CSA07Skims/data/hscpMuonSkim.cfi"
#replace globalMuons.TrackerCollectionLabel = TrackRefitter
       replace MuonSeed.EnableCSCMeasurement = false
       replace standAloneMuons.STATrajBuilderParameters.RefitterParameters.EnableRPCMeasurement = false
       replace standAloneMuons.STATrajBuilderParameters.BWFilterParameters.EnableRPCMeasurement = false
       replace standAloneMuons.STATrajBuilderParameters.RefitterParameters.EnableCSCMeasurement = false
       replace standAloneMuons.STATrajBuilderParameters.BWFilterParameters.EnableCSCMeasurement = false
 path hscpMuon = { hscpMuonSeq & dt4DSegments & MuonSeed & standAloneMuons & dedxHarmonic4 & dedxFit & betaFromTOF }
  path hscpMET ={  hscpMETSeq & dt4DSegments & MuonSeed & standAloneMuons & dedxHarmonic4 & dedxFit & betaFromTOF }

# path paa = {hscpMuonSeq & dt1DRecHits & dt4DSegments & ckftracks & muonreco & dedxHarmonic4 & dedxFit & betaFromTOF }
# path paa2 = {hscpMETSeq & dt1DRecHits & dt4DSegments & ckftracks & muonreco & dedxHarmonic4 & dedxFit & betaFromTOF }
#  path p2 = {dt1DRecHits, dt4DSegments, muonreco , hscpMuonSeq & dedxHarmonic4 & dedxFit & betaFromTOF }
#  path p = {hscpMuonSeq & dedxHarmonic4 & dedxFit & betaFromTOF }
#  path p = {dt4DSegments & MuonSeed & standAloneMuons & TrackRefitter,dedxHitsFromRefitter, dedxHarmonic4,dedxFit, betaFromTOF} 
  endpath outpath = { out }

}
